function getType(){let type;return $(".active")[0].title}function queryPrepare(queryStr){let strArray=queryStr.trim().split(" "),first,last;return[strArray[0],strArray[strArray.length-1]]}function queryPrepareDeptLoc(queryStr){let query;return queryStr.trim()}let delay;function validateForm(formId){resetForm(formId);let inputs=$(`#${formId}-form .form-required`);for(const[key,obj]of Object.entries(inputs))""==obj.value&&$(`#${obj.id}`).addClass("border-danger").siblings().append('<span class="text-danger form-response">Field Required!</span>');$(`#${formId}-form .form-response`).length>0&&displayAlert(formId,400,"Form Invalid!")}function resetForm(formId){$(`#${formId}-alert`).html(""),$(`#${formId}-form .form-response`).remove(),$(`#${formId}-form .form-required`).removeClass("border-danger")}function displayAlert(displayId,status,message){200!=status?$(`#${displayId}-alert`).html(`<div class="alert alert-dismissible fade show alert-danger" role="alert">${message}<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>`):$(`#${displayId}-alert`).html(`<div class="alert alert-dismissible fade show alert-success" role="alert">${message}<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>`),$("#search-bar").val("")}function displayOptions(object,selectedValue){let content="";0==selectedValue&&(content+='<option selected hidden value="">Select...</option>');for(const[key,value]of Object.entries(object.data))value.id==selectedValue?content+=`<option value="${value.id}" selected>${value.name}</option>`:content+=`<option value="${value.id}">${value.name}</option>`;return content}function displaySelected(selectId,selectedValue){let options=$(`#${selectId} option`),selected=selectedValue,content="";$(`#${selectId} option:selected`).attr("selected",!1);for(let i=0;i<options.length;i++)options[i].value==selected?content+=`<option value="${options[i].value}" selected>${options[i].innerHTML}</option>`:content+=`<option value="${options[i].value}">${options[i].innerHTML}</option>`;return content}function viewModal(object){const data=object.data,title=""==data[0].jobTitle?"No Job Title":data[0].jobTitle;$("#view-modal #modal-title").html(`${data[0].firstName} ${data[0].lastName}`),$("#view-modal #cardJob").html(`${title}`),$("#view-modal #cardLocation").html(`\n\t\t${data[0].department} | ${data[0].location}<br><br>\n\t\t<a href="mailto:${data[0].email}" id="cardEmail">${data[0].email}</a>`),$("#view-modal").modal("show")}function addModal(type){let content="";switch(type){case"personnel":content=`<div class="form-row">\n\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t<label for="add-first">First Name<span class="text-danger">*</span></label>\n\t\t\t\t\t<input type="text" id="add-first" class="form-control form-required" placeholder="First Name">\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t<label for="add-last">Last Name<span class="text-danger">*</span></label>\n\t\t\t\t\t<input type="text" id="add-last" class="form-control form-required" placeholder="Last Name">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="form-group">\n\t\t\t\t<label for="add-title">Job Title<span class="text-danger">*</span></label>\n\t\t\t\t<input type="text" id="add-title" class="form-control form-required" placeholder="Job Title">\n\t\t\t</div>\n\t\t\t<div class="form-group">\t\n\t\t\t\t<label for="add-email">Email<span class="text-danger">*</span></label>\n\t\t\t\t<input type="email" id="add-email" class="form-control form-required" placeholder="Email">\n\t\t\t</div>\n\t\t\t<div class="form-row">\n\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t<label for="add-department">Department<span class="text-danger">*</span></label>\n\t\t\t\t\t<select id="add-department" class="form-control form-required">\n            ${getUniqueDepartments(0)}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t<label for="add-location">Location<span class="text-danger">*</span></label>\n\t\t\t\t\t<select id="add-location" class="form-control form-required" readonly disabled>\n            ${getUniqueLocations(0)}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>`;break;case"department":content=`<div class="form-group">\n\t\t\t\t<label for="add-department">Department Name<span class="text-danger">*</span></label>\n\t\t\t\t<input type="text" id="add-department" class="form-control form-required">\n\t\t\t</div>\n\t\t\t<div class="form-group">\n\t\t\t\t<label for="add-location">Department Location<span class="text-danger">*</span></label>\n\t\t\t\t<select id="add-location" class="form-control form-required">\n          ${getUniqueLocations(0)}\n\t\t\t\t</select>\n\t\t\t</div>`;break;case"location":content='<div class="form-group">\n\t\t\t\t\t<label for="add-location">Location Name<span class="text-danger">*</span></label>\n\t\t\t\t\t<input type="text" id="add-location" class="form-control form-required">\n\t\t\t\t</div>'}$("#add-type").html(type).css("text-transform","capitalize"),$("#add-form").html(content),$("#add-modal").modal("show")}function editModal(type,id){switch($("#edit-type").html(type).css("text-transform","capitalize"),$("#edit-id").html(id),type){case"personnel":getPersonnelById(id,"form","edit-location");break;case"department":getDepartmentById(id);break;case"location":getLocationById(id)}$("#edit-modal").modal("show")}function deleteModal(type,id){$("#delete-type").html(type).css("text-transform","capitalize"),$("#delete-id").html(id);let content="";switch(type){case"personnel":content='<h6>Are you sure you wish to delete record?</h6>\n\t\t\t\t<button id="delete-modal-yes" class="btn btn-success">Yes</button>\n\t\t\t\t<button id="delete-modal-no" class="btn btn-danger" data-dismiss="modal">No</button>';break;case"department":content='<h6>Are you sure you wish to delete department?</h6>\n\t\t\t\t<button id="delete-modal-yes" class="btn btn-success">Yes</button>\n\t\t\t\t<button id="delete-modal-no" class="btn btn-danger" data-dismiss="modal">No</button>';break;case"location":content='<h6>Are you sure you wish to delete location?</h6>\n\t\t\t\t<button type="button" id="delete-modal-yes" class="btn btn-success">Yes</button>\n\t\t\t\t<button id="delete-modal-no" class="btn btn-danger" data-dismiss="modal">No</button>'}$("#delete-alert").html(content),$("#delete-modal").modal("show")}function addRecord(type){let addObj={first:$("#add-first").val(),last:$("#add-last").val(),title:$("#add-title").val(),email:$("#add-email").val(),department:$("#add-department").val(),location:$("#add-location").val()};switch(type){case"personnel":""!=addObj.first&&""!=addObj.last&&""!=addObj.title&&""!=addObj.email&&""!=addObj.department&&addPersonnel(addObj);break;case"department":""!=addObj.department&&""!=addObj.location&&addDepartment(addObj);break;case"location":""!=addObj.location&&addLocation(addObj)}}function addPersonnel(addObj){$.ajax({async:!0,global:!1,type:"POST",url:"php/insertPersonnel.php",dataType:"json",data:{firstName:addObj.first,lastName:addObj.last,jobTitle:addObj.title,email:addObj.email,department:addObj.department},success:function(results){displayAlert("add",results.status.code,results.status.description),getAllPersonnel("")},error:function(){console.log("Add personnel error occured")}})}function addDepartment(addObj){$.ajax({async:!0,global:!1,type:"POST",url:"php/insertDepartment.php",dataType:"json",data:{department:addObj.department,location:addObj.location},success:function(results){displayAlert("add",results.status.code,results.status.description),getAllDepartments("")},error:function(){console.log("Add department error occured")}})}function addLocation(addObj){$.ajax({async:!0,global:!1,type:"POST",url:"php/insertLocation.php",dataType:"json",data:{location:addObj.location},success:function(results){displayAlert("add",results.status.code,results.status.description),getAllLocations("")},error:function(){console.log("Error occured adding location!")}})}function deleteRecord(type,id){switch(type){case"personnel":""!=id&&deletePersonnel(id);break;case"department":""!=id&&deleteDepartment(id);break;case"location":""!=id&&deleteLocation(id)}}function deletePersonnel(deleteId){$.ajax({async:!0,global:!1,type:"POST",url:"php/deletePersonnelByID.php",dataType:"json",data:{employeeId:deleteId},success:function(results){displayAlert("delete",results.status.code,results.status.description),getAllPersonnel("",$("#sort-list").val())},error:function(){console.log("Error occured deleting personnel record!")}})}function deleteDepartment(deleteId){$.ajax({async:!0,global:!1,type:"POST",url:"php/deleteDepartmentByID.php",dataType:"json",data:{departmentId:deleteId},success:function(results){displayAlert("delete",results.status.code,results.status.description),getAllDepartments("")},error:function(){console.log("Error occured deleting department!")}})}function deleteLocation(deleteId){$.ajax({async:!0,global:!1,type:"POST",url:"php/deleteLocationByID.php",dataType:"json",data:{locationId:deleteId},success:function(results){displayAlert("delete",results.status.code,results.status.description),getAllLocations("")},error:function(){console.log("Error occured deleting location!")}})}function getAllPersonnel(filter,sort){const first=queryPrepare(filter)[0],last=queryPrepare(filter)[1];$.ajax({async:!0,global:!1,type:"POST",url:"php/getAllPersonnel.php",dataType:"json",data:{firstName:first,lastName:last,sortBy:sort},success:function(result){const employer=result.data;let content="";for(let i=0;i<employer.length;i++)content+=`<tr>\n            <td class="id">${employer[i].id}</td>\n            <td class="align-middle">${employer[i].firstName} ${employer[i].lastName}</td>\n              <td class="text-right">\n                <div class="btn-group" role="group">\n                  <button class="view-btn btn text-primary" title="view"><i class="bi bi-eye-fill"></i></button>\n                  <button class="edit-btn btn text-primary" title="edit"><i class="bi bi-pencil-square"></i></button>\n                  <button class="delete-btn btn text-danger" title="delete"><i class="bi bi-trash3-fill"></i></button>\n                </div>\n              </td>\n          </tr>`;$("#personnel-table tbody").html(content)}})}function getAllDepartments(filter){const search=queryPrepareDeptLoc(filter);$.ajax({async:!0,global:!1,type:"POST",url:"php/getAllDepartments.php",dataType:"json",data:{search:search},success:function(result){const department=result.data;let content="";for(let i=0;i<department.length;i++)content+=`<tr>\n            <td class="id">${department[i].id}</td>\n            <td class="align-middle">${department[i].name}</td>\n              <td class="text-right">\n                <div class="btn-group" role="group">\n                  <button class="edit-btn btn text-primary" title="edit"><i class="bi bi-pencil-square"></i></button>\n                  <button class="delete-btn btn text-danger" title="delete"><i class="bi bi-trash3-fill"></i></button>\n                </div>\n              </td>\n          </tr>`;$("#department-table tbody").html(content)}})}function getAllLocations(filter){const search=queryPrepareDeptLoc(filter);$.ajax({async:!0,global:!1,type:"POST",url:"php/getAllLocations.php",dataType:"json",data:{search:search},success:function(result){const locations=result.data;let content="";for(let i=0;i<locations.length;i++)content+=`<tr>\n            <td class="id">${locations[i].id}</td>\n            <td class="align-middle">${locations[i].name}</td>\n              <td class="text-right">\n                <div class="btn-group" role="group">\n                  <button class="edit-btn btn text-primary" title="edit"><i class="bi bi-pencil-square"></i></button>\n                  <button class="delete-btn btn text-danger" title="delete"><i class="bi bi-trash3-fill"></i></button>\n                </div>\n              </td>\n          </tr>`;$("#location-table tbody").html(content)}})}function getPersonnelById(personnelId,type,selectId){$.ajax({async:!0,global:!1,type:"POST",url:"php/getPersonnelByID.php",dataType:"json",data:{id:personnelId},success:function(results){"modal"==type?viewModal(results):"form"==type&&($("#edit-form").html(`<div class="form-row">\n\t\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t\t<label for="edit-first">First Name<span class="text-danger">*</span></label>\n\t\t\t\t\t\t<input type="text" id="edit-first" class="form-control form-required" value="${results.data[0].firstName}">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t\t<label for="edit-last">Last Name<span class="text-danger">*</span></label>\n\t\t\t\t\t\t<input type="text" id="edit-last" class="form-control form-required" value="${results.data[0].lastName}">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label for="edit-title">Job Title<span class="text-danger">*</span></label>\n\t\t\t\t\t<input type="text" id="edit-title" class="form-control form-required" value="${results.data[0].jobTitle}">\n\t\t\t\t</div>\n\t\t\t\t<div class="form-row">\n\t\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t\t<label for="edit-email">Email<span class="text-danger">*</span></label>\n\t\t\t\t\t\t<input type="email" id="edit-email" class="form-control form-required" value="${results.data[0].email}">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-row">\n\t\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t\t<label for="edit-department">Department<span class="text-danger">*</span></label>\n\t\t\t\t\t\t<select id="edit-department" class="form-control form-required">\n\t\t\t\t\t\t\t${getUniqueDepartments(results.data[0].departmentId)}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="form-group col-12 col-md-6">\n\t\t\t\t\t\t<label for="edit-location">Location<span class="text-danger">*</span></label>\n\t\t\t\t\t\t<select id="edit-location" class="form-control form-required" readonly disabled>\n\t\t\t\t\t\t\t${getUniqueLocations(0)}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`),$("#edit-location").html(getLocationByDepartmentId(results.data[0].departmentId,selectId)))},error:function(){console.log("Error occured getting personnel by id!")}})}function getDepartmentById(departmentId){$.ajax({async:!1,global:!1,type:"POST",url:"php/getDepartmentByID.php",dataType:"json",data:{departmentId:departmentId},success:function(results){$("#edit-form").html(`<div class="form-group">\n\t\t\t\t<label for="edit-department">Department Name<span class="text-danger">*</span></label>\n\t\t\t\t<input type="text" id="edit-department" class="form-control form-required" value="${results.data[0].name}">\n\t\t\t</div>\n\t\t\t<div class="form-group">\n\t\t\t\t<label for="edit-location">Department Location<span class="text-danger">*</span></label>\n\t\t\t\t<select id="edit-location" class="form-control form-required"">\n\t\t\t\t\t${getUniqueLocations(results.data[0].locationId)}\n\t\t\t\t</select>\n\t\t\t</div>`)},error:function(){console.log("Error occured getting department by id!")}})}function getLocationById(locationId){$.ajax({async:!1,global:!1,type:"POST",url:"php/getLocationByID.php",dataType:"json",data:{locationId:locationId},success:function(results){$("#edit-form").html(`\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label for="edit-location">Location Name<span class="text-danger">*</span></label>\n\t\t\t\t\t<input type="text" id="edit-location" class="form-control form-required" value="${results.data[0].name}">\n\t\t\t\t</div>`)},error:function(){console.log("Error occured getting location by id!")}})}function getUniqueDepartments(selectedValue){let data;return $.ajax({async:!1,global:!1,url:"php/getUniqueDepartments.php",dataType:"json",success:function(results){data=displayOptions(results,selectedValue)},error:function(){console.log("Error occured getting unique departments!")}}),data}function getUniqueLocations(selectedValue){let data;return $.ajax({async:!1,global:!1,url:"php/getUniqueLocations.php",dataType:"json",success:function(results){data=displayOptions(results,selectedValue)},error:function(){console.log("Error occured getting unique locations!")}}),data}function getLocationByDepartmentId(departmentId,selectId){let data;return $.ajax({async:!1,global:!1,type:"POST",url:"php/getLocationByDepartmentID.php",dataType:"json",data:{departmentId:departmentId},success:function(results){data=displaySelected(selectId,results.data[0].id)},error:function(){console.log("error occured getting location by id")}}),data}function editRecord(type,editId){let editObj={first:$("#edit-first").val(),last:$("#edit-last").val(),title:$("#edit-title").val(),email:$("#edit-email").val(),department:$("#edit-department").val(),location:$("#edit-location").val()};switch(type){case"personnel":""!=editObj.first&&""!=editObj.last&&""!=editObj.title&&""!=editObj.email&&""!=editObj.department&&editPersonnel(editObj,editId);break;case"department":""!=editObj.department&&""!=editObj.location&&editDepartment(editObj,editId);break;case"location":""!=editObj.location&&editLocation(editObj,editId)}}function editPersonnel(editObj,editId){$.ajax({async:!0,global:!1,type:"POST",url:"php/editPersonnel.php",dataType:"json",data:{employeeId:editId,firstName:editObj.first,lastName:editObj.last,jobTitle:editObj.title,email:editObj.email,department:editObj.department},success:function(results){displayAlert("edit",results.status.code,results.status.description),getAllPersonnel("",$("#sort-list").val())},error:function(){console.log("Error occured editting personnel!")}})}function editDepartment(editObj,editId){$.ajax({async:!0,global:!1,type:"POST",url:"php/editDepartment.php",dataType:"json",data:{departmentId:editId,department:editObj.department,location:editObj.location},success:function(results){displayAlert("edit",results.status.code,results.status.description),getAllDepartments("")},error:function(){console.log("Error occured editting department!")}})}function editLocation(editObj,editId){$.ajax({async:!0,global:!1,type:"POST",url:"php/editLocation.php",dataType:"json",data:{locationId:editId,location:editObj.location},success:function(results){displayAlert("edit",results.status.code,results.status.description),getAllLocations("")},error:function(){console.log("Error occured editting location!")}})}$(window).on("load",(function(){$("#preloader").length&&$("#preloader").delay(1e3).fadeOut("slow",(function(){$(this).remove()}))})),$("#search-bar").on("input",(function(){const input=$("#search-bar").val();switch(clearTimeout(delay),getType()){case"personnel":delay=setTimeout((function(){getAllPersonnel(input,$("#sort-list").val())}),300);break;case"department":delay=setTimeout((function(){getAllDepartments(input)}),300);break;case"location":delay=setTimeout((function(){getAllLocations(input)}),300)}})),$("#sort-list").on("change",(function(){getAllPersonnel($("#search-bar").val(),$("#sort-list").val())})),$(document).ready((function(){$(window).keydown((function(e){if(13==e.keyCode)return e.preventDefault(),!1})),getAllPersonnel("",$("#sort-list").val()),getAllDepartments(""),getAllLocations(""),$(".company-tabs").html("Personnel"),$("#personnel-btn").click((function(){$("#department-table").hide(),$("#location-table").hide(),$("#personnel-table").show(),$("#department-btn").removeClass("active"),$("#location-btn").removeClass("active"),$("#sort-list").removeAttr("disabled"),$(this).addClass("active"),resetForm("add"),resetForm("edit"),$(".company-tabs").html("Personnel")})),$("#department-btn").click((function(){$("#personnel-table").hide(),$("#location-table").hide(),$("#department-table").show(),$("#personnel-btn").removeClass("active"),$("#location-btn").removeClass("active"),$("#sort-list").attr("disabled",!0),$(this).addClass("active"),resetForm("add"),resetForm("edit"),$(".company-tabs").html("Departments")})),$("#location-btn").click((function(){$("#personnel-table").hide(),$("#department-table").hide(),$("#location-table").show(),$("#personnel-btn").removeClass("active"),$("#department-btn").removeClass("active"),$("#sort-list").attr("disabled",!0),$(this).addClass("active"),resetForm("add"),resetForm("edit"),$(".company-tabs").html("Locations")})),$("#refresh-btn").click((function(){getAllPersonnel("",$("#sort-list").val()),getAllDepartments(""),getAllLocations(""),$("#search-bar").val(""),resetForm("add"),resetForm("edit")})),$(document).on("click","tbody tr .view-btn",(function(){let id;getPersonnelById($(this).parent().parent().siblings().html(),"modal")})),$("#add-btn").click((function(){resetForm("add"),addModal(getType())})),$(document).on("change","#add-form #add-department",(function(){let departmentId=$("#add-department").val();$("#add-location").html(getLocationByDepartmentId(departmentId,"add-location"))})),$("#add-submit-btn").click((function(){let type=$("#add-type").html();validateForm("add"),addRecord(type)})),$(document).on("click","tbody tr .edit-btn",(function(){let id=$(this).parent().parent().siblings().html();editModal(getType(),id)})),$(document).on("change","#edit-form #edit-department",(function(){let departmentId=$("#edit-department").val();$("#edit-location").html(getLocationByDepartmentId(departmentId,"edit-location"))})),$(document).on("click","#edit-submit-btn",(function(){let id=$("#edit-id").html();validateForm("edit"),editRecord(getType(),id)})),$(document).on("click","tbody tr .delete-btn",(function(){let id=$(this).parent().parent().siblings().html();deleteModal(getType(),id)})),$(document).on("click","#delete-modal-yes",(function(){let id=$("#delete-id").html();deleteRecord(getType(),id)}))}));