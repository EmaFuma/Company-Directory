function getType(){let type;return $(".active")[0].title}function validateForm(formId){resetForm(formId);let inputs=$(`#${formId}-form .form-required`);for(const[key,obj]of Object.entries(inputs))""==obj.value&&$(`#${obj.id}`).addClass("border-danger").siblings().append('<span class="text-danger form-response">Field Required!</span>');$(`#${formId}-form .form-response`).length>0&&displayAlert(formId,400,"Form Invalid!")}function resetForm(formId){$(`#${formId}-alert`).html(""),$(`#${formId}-form .form-response`).remove(),$(`#${formId}-form .form-required`).removeClass("border-danger")}function displayAlert(displayId,status,message){200!=status?$(`#${displayId}-alert`).html(`<div class="alert alert-dismissible fade show alert-danger" role="alert">${message}<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>`):$(`#${displayId}-alert`).html(`<div class="alert alert-dismissible fade show alert-success" role="alert">${message}<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>`)}function displayCheck(displayId){$(`#${displayId}-alert`).html('\n      <h6 class="my-2">Are you sure you wish to delete record?</h6>'),$(`#${displayId}-footer`).html('\n      <button id="delete-modal-yes" class="btn btn-success">Yes</button>\n      <button id="delete-modal-no" class="btn btn-danger" data-dismiss="modal">No</button>').show()}function displayOptions(object,selectedValue,filter,filterPlace){let content="";0==selectedValue&&"filter"==filter?content+=`<option selected hidden value="">${filterPlace}</option>`:0==selectedValue&&(content+='<option selected hidden value="">Select...</option>');for(const[key,value]of Object.entries(object.data))value.id==selectedValue?content+=`<option value="${value.id}" selected>${value.name}</option>`:content+=`<option value="${value.id}">${value.name}</option>`;return content}function displaySelected(selectId,selectedValue){let options=$(`#${selectId} option`),selected=selectedValue,content="";$(`#${selectId} option:selected`).attr("selected",!1);for(let i=0;i<options.length;i++)options[i].value==selected?content+=`<option value="${options[i].value}" selected>${options[i].innerHTML}</option>`:content+=`<option value="${options[i].value}">${options[i].innerHTML}</option>`;return content}function addModal(type){switch(type){case"personnel":$("#personnel-add-form input").val(""),$("#personnel-add-department").html(getUniqueDepartments(0)),$("#personnel-add-location").html(getUniqueLocations(0)),$("#personnel-add-modal").modal("show");break;case"department":$("#department-add-form input").val(""),$("#department-add-location").html(getUniqueLocations(0)),$("#department-add-modal").modal("show");break;case"location":$("#location-add-form input").val(""),$("#location-add-modal").modal("show")}}function editModal(type,id){switch(type){case"personnel":$("#personnel-edit-id").html(id),getPersonnelById(id,"personnel-edit-location");break;case"department":$("#department-edit-id").html(id),getDepartmentById(id);break;case"location":$("#location-edit-id").html(id),getLocationById(id)}}function deleteModal(type,id,first,last){const check=!0;let content="";switch(type){case"personnel":$("#delete-type").html(`${last} ${first}`),$("#delete-id").html(id),content=displayCheck("delete");break;case"department":case"location":$("#delete-type").html(`${last}`),$("#delete-id").html(id),content=deleteRecord(type,id,!0)}$("#delete-alert").html(content),$("#delete-modal").modal("show")}function filter(){$("#filter-input").val(""),$("#department-filter").html(getUniqueDepartments(0,"filter","Departments")),$("#location-filter").html(getUniqueLocations(0,"filter","Locations"))}function addRecord(type){let addObj={first:$("#add-first").val(),last:$("#add-last").val(),title:$("#add-title").val(),email:$("#add-email").val(),department:$(`#${type}-add-department`).val(),location:$(`#${type}-add-location`).val()};switch(type){case"personnel":""!=addObj.first&&""!=addObj.last&&""!=addObj.title&&""!=addObj.email&&""!=addObj.department&&addPersonnel(addObj,type);break;case"department":""!=addObj.department&&""!=addObj.location&&addDepartment(addObj,type);break;case"location":""!=addObj.location&&addLocation(addObj,type)}}function addPersonnel(addObj,type){$.ajax({async:!0,global:!1,type:"POST",url:"php/insertPersonnel.php",dataType:"json",data:{firstName:addObj.first,lastName:addObj.last,jobTitle:addObj.title,email:addObj.email,department:addObj.department},success:function(results){displayAlert(`${type}-add`,results.status.code,results.status.description),getAllPersonnel()},error:function(){console.log("Add personnel error occured")}})}function addDepartment(addObj,type){$.ajax({async:!0,global:!1,type:"POST",url:"php/insertDepartment.php",dataType:"json",data:{department:addObj.department,location:addObj.location},success:function(results){displayAlert(`${type}-add`,results.status.code,results.status.description),getAllDepartments()},error:function(){console.log("Add department error occured")}})}function addLocation(addObj,type){$.ajax({async:!0,global:!1,type:"POST",url:"php/insertLocation.php",dataType:"json",data:{location:addObj.location},success:function(results){displayAlert(`${type}-add`,results.status.code,results.status.description),getAllLocations()},error:function(){console.log("Error occured adding location!")}})}function deleteRecord(type,id,check){switch(type){case"personnel":""!=id&&deletePersonnel(id);break;case"department":""!=id&&(check?checkDepartment(id):deleteDepartment(id));break;case"location":""!=id&&(check?checkLocation(id):deleteLocation(id))}}function deletePersonnel(deleteId){$.ajax({async:!0,global:!1,type:"POST",url:"php/deletePersonnelByID.php",dataType:"json",data:{employeeId:deleteId},success:function(results){displayAlert("delete",results.status.code,results.status.description),getAllPersonnel()},error:function(){console.log("Error occured deleting personnel record!")}})}function checkDepartment(deleteId){$("#delete-footer").hide(),$.ajax({async:!0,global:!1,type:"POST",url:"php/checkDepartmentByID.php",dataType:"json",data:{departmentId:deleteId},success:function(results){200!=results.status.code?$("#delete-alert").html(`<h6>${results.status.description}</h6>`):displayCheck("delete")},error:function(){console.log("Error occured deleting department!")}})}function deleteDepartment(deleteId){$.ajax({async:!0,global:!1,type:"POST",url:"php/deleteDepartmentByID.php",dataType:"json",data:{departmentId:deleteId},success:function(results){displayAlert("delete",results.status.code,results.status.description),getAllDepartments()},error:function(){console.log("Error occured deleting department!")}})}function checkLocation(deleteId){$("#delete-footer").hide(),$.ajax({async:!0,global:!1,type:"POST",url:"php/checkLocationByID.php",dataType:"json",data:{locationId:deleteId},success:function(results){200!=results.status.code?$("#delete-alert").html(`<h6>${results.status.description}</h6>`):displayCheck("delete")},error:function(){console.log("Error occured deleting department!")}})}function deleteLocation(deleteId){$.ajax({async:!0,global:!1,type:"POST",url:"php/deleteLocationByID.php",dataType:"json",data:{locationId:deleteId},success:function(results){displayAlert("delete",results.status.code,results.status.description),getAllLocations()},error:function(){console.log("Error occured deleting location!")}})}function getAllPersonnel(){$.ajax({async:!0,global:!1,type:"POST",url:"php/getAllPersonnel.php",dataType:"json",success:function(result){const employer=result.data;let content="";for(let i=0;i<employer.length;i++)content+=`<tr class="${employer[i].id}">\n              <td>${employer[i].lastName}</td>\n              <td>${employer[i].firstName}</td>\n              <td class="d-none d-md-table-cell">${employer[i].department}</td>\n              <td class="align-middle text-right py-0">\n                  <div class="btn-group" role="group">\n                    <button class="edit-btn btn text-primary" title="edit"><i class="bi bi-pencil-square"></i></button>\n                    <button class="delete-btn btn text-danger" title="delete"><i class="bi bi-trash3-fill"></i></button>\n                  </div>\n                </td>\n            </tr>`;$("#personnel-table tbody").html(content)}})}function getAllDepartments(){$.ajax({async:!0,global:!1,type:"POST",url:"php/getAllDepartments.php",dataType:"json",success:function(result){const department=result.data;let content="";for(let i=0;i<department.length;i++)content+=`<tr class="${department[i].id}">\n              <td>${department[i].name}</td>\n              <td class="d-none d-md-table-cell">${department[i].location}</td>\n                <td class="align-middle text-right py-0">\n                  <div class="btn-group" role="group">\n                    <button class="edit-btn btn text-primary" title="edit"><i class="bi bi-pencil-square"></i></button>\n                    <button class="delete-btn btn text-danger" title="delete"><i class="bi bi-trash3-fill"></i></button>\n                  </div>\n                </td>\n            </tr>`;$("#department-table tbody").html(content)}})}function getAllLocations(){$.ajax({async:!0,global:!1,type:"POST",url:"php/getAllLocations.php",dataType:"json",success:function(result){const locations=result.data;let content="";for(let i=0;i<locations.length;i++)content+=`<tr class="${locations[i].id}">\n              <td>${locations[i].name}</td>\n                <td class="align-middle text-right py-0">\n                  <div class="btn-group" role="group">\n                    <button class="edit-btn btn text-primary" title="edit"><i class="bi bi-pencil-square"></i></button>\n                    <button class="delete-btn btn text-danger" title="delete"><i class="bi bi-trash3-fill"></i></button>\n                  </div>\n                </td>\n            </tr>`;$("#location-table tbody").html(content)}})}function getPersonnelById(personnelId,selectId){$.ajax({async:!0,global:!1,type:"POST",url:"php/getPersonnelByID.php",dataType:"json",data:{id:personnelId},success:function(results){const title=""==results.data[0].jobTitle?"No Job Title":results.data[0].jobTitle;resetForm("personnel-edit"),$("#personnel-edit-type").html(`${results.data[0].lastName} ${results.data[0].firstName}`),$("#edit-first").val(`${results.data[0].firstName}`),$("#edit-last").val(`${results.data[0].lastName}`),$("#edit-title").val(`${title}`),$("#edit-email").val(`${results.data[0].email}`),$("#personnel-edit-department").html(getUniqueDepartments(results.data[0].departmentId)),$("#personnel-edit-location").html(getUniqueLocations(0)),$("#personnel-edit-location").html(getLocationByDepartmentId(results.data[0].departmentId,selectId)),$("#personnel-edit-modal").modal("show")},error:function(){console.log("Error occured getting personnel by id!")}})}function getDepartmentById(departmentId){$.ajax({async:!1,global:!1,type:"POST",url:"php/getDepartmentByID.php",dataType:"json",data:{departmentId:departmentId},success:function(results){resetForm("department-edit"),$("#department-edit-type").html(`${results.data[0].name}`),$("#department-edit-department").val(`${results.data[0].name}`),$("#department-edit-location").html(`${getUniqueLocations(results.data[0].locationId)}`),$("#department-edit-modal").modal("show")},error:function(){console.log("Error occured getting department by id!")}})}function getLocationById(locationId){$.ajax({async:!1,global:!1,type:"POST",url:"php/getLocationByID.php",dataType:"json",data:{locationId:locationId},success:function(results){resetForm("location-edit"),$("#location-edit-type").html(`${results.data[0].name}`),$("#location-edit-location").val(`${results.data[0].name}`),$("#location-edit-modal").modal("show")},error:function(){console.log("Error occured getting location by id!")}})}function getUniqueDepartments(selectedValue,filter,filterPlace){let data;return $.ajax({async:!1,global:!1,url:"php/getUniqueDepartments.php",dataType:"json",success:function(results){data=displayOptions(results,selectedValue,filter,filterPlace)},error:function(){console.log("Error occured getting unique departments!")}}),data}function getUniqueLocations(selectedValue,filter,filterPlace){let data;return $.ajax({async:!1,global:!1,url:"php/getUniqueLocations.php",dataType:"json",success:function(results){data=displayOptions(results,selectedValue,filter,filterPlace)},error:function(){console.log("Error occured getting unique locations!")}}),data}function getLocationByDepartmentId(departmentId,selectId){let data;return $.ajax({async:!1,global:!1,type:"POST",url:"php/getLocationByDepartmentID.php",dataType:"json",data:{departmentId:departmentId},success:function(results){data=displaySelected(selectId,results.data[0].id)},error:function(){console.log("error occured getting location by id")}}),data}function getFilterPersonnel(emp,dep,loc){$.ajax({async:!0,global:!1,type:"POST",url:"php/getFilterPersonnel.php",dataType:"json",data:{employee:emp,department:dep,location:loc},success:function(result){const employer=result.data.personnel;let content="";for(let i=0;i<employer.length;i++)content+=`<tr class="${employer[i].id}">\n              <td>${employer[i].lastName}</td>\n              <td>${employer[i].firstName}</td>\n              <td class="d-none d-md-table-cell">${employer[i].department}</td>\n                <td class="align-middle text-right py-0">\n                  <div class="btn-group" role="group">\n                    <button class="edit-btn btn text-primary" title="edit"><i class="bi bi-pencil-square"></i></button>\n                    <button class="delete-btn btn text-danger" title="delete"><i class="bi bi-trash3-fill"></i></button>\n                  </div>\n                </td>\n            </tr>`;$("#personnel-table tbody").html(content)},error:function(){console.log("error occured getting location by id")}})}function editRecord(type,editId){let editObj={first:$("#edit-first").val(),last:$("#edit-last").val(),title:$("#edit-title").val(),email:$("#edit-email").val(),department:$(`#${type}-edit-department`).val(),location:$(`#${type}-edit-location`).val()};switch(type){case"personnel":""!=editObj.first&&""!=editObj.last&&""!=editObj.title&&""!=editObj.email&&""!=editObj.department&&editPersonnel(editObj,editId,type);break;case"department":""!=editObj.department&&""!=editObj.location&&editDepartment(editObj,editId,type);break;case"location":""!=editObj.location&&editLocation(editObj,editId,type)}}function editPersonnel(editObj,editId,type){$.ajax({async:!0,global:!1,type:"POST",url:"php/editPersonnel.php",dataType:"json",data:{employeeId:editId,firstName:editObj.first,lastName:editObj.last,jobTitle:editObj.title,email:editObj.email,department:editObj.department},success:function(results){displayAlert(`${type}-edit`,results.status.code,results.status.description),getAllPersonnel()},error:function(){console.log("Error occured editting personnel!")}})}function editDepartment(editObj,editId,type){$.ajax({async:!0,global:!1,type:"POST",url:"php/editDepartment.php",dataType:"json",data:{departmentId:editId,department:editObj.department,location:editObj.location},success:function(results){displayAlert(`${type}-edit`,results.status.code,results.status.description),getAllDepartments("")},error:function(){console.log("Error occured editting department!")}})}function editLocation(editObj,editId,type){$.ajax({async:!0,global:!1,type:"POST",url:"php/editLocation.php",dataType:"json",data:{locationId:editId,location:editObj.location},success:function(results){displayAlert(`${type}-edit`,results.status.code,results.status.description),getAllLocations("")},error:function(){console.log("Error occured editting location!")}})}$(window).on("load",(function(){$("#preloader").length&&$("#preloader").delay(1e3).fadeOut("slow",(function(){$(this).remove()}))})),$(document).ready((function(){function filterByInput(){let delay;$("#filter-input").on("input",(function(){const employee=$("#filter-input").val(),department=$("#department-filter").val(),location=$("#location-filter").val();clearTimeout(delay),delay=setTimeout((function(){getFilterPersonnel(employee,department,location)}))}))}function filterByDepartmentOrLocation(){let delay;const employee=$("#filter-input").val(),department=$("#department-filter").val(),location=$("#location-filter").val();clearTimeout(delay),delay=setTimeout((function(){getFilterPersonnel(employee,department,location)}))}$(window).keydown((function(e){if(13==e.keyCode)return e.preventDefault(),!1})),getAllPersonnel(),getAllDepartments(),getAllLocations(),filter(),filterByInput(),$(".company-tabs").html("Personnel"),$("#personnel-btn").click((function(){$("#department-table").hide(),$("#location-table").hide(),$("#personnel-table").show(),$("#department-btn").removeClass("active"),$("#location-btn").removeClass("active"),$(this).addClass("active"),resetForm(`${getType()}-add`),resetForm(`${getType()}-edit`),$(".company-tabs").html("Personnel")})),$("#department-btn").click((function(){$("#personnel-table").hide(),$("#location-table").hide(),$("#department-table").show(),$("#personnel-btn").removeClass("active"),$("#location-btn").removeClass("active"),$(this).addClass("active"),resetForm(`${getType()}-add`),resetForm(`${getType()}-edit`),$(".company-tabs").html("Departments")})),$("#location-btn").click((function(){$("#personnel-table").hide(),$("#department-table").hide(),$("#location-table").show(),$("#personnel-btn").removeClass("active"),$("#department-btn").removeClass("active"),$(this).addClass("active"),resetForm(`${getType()}-add`),resetForm(`${getType()}-edit`),$(".company-tabs").html("Locations")})),$("#refresh-btn").click((function(){getAllPersonnel(),getAllDepartments(),getAllLocations(),filter(),filterByInput(),resetForm(`${getType()}-add`),resetForm(`${getType()}-edit`)})),$(document).on("change","#department-filter",(function(){filterByDepartmentOrLocation()})),$(document).on("change","#location-filter",(function(){filterByDepartmentOrLocation()})),$("#add-btn").click((function(){resetForm(`${getType()}-add`),addModal(getType())})),$(document).on("change",`#${getType()}-add-form #${getType()}-add-department`,(function(){let departmentId=$(`#${getType()}-add-department`).val();$(`#${getType()}-add-location`).html(getLocationByDepartmentId(departmentId,`${getType()}-add-location`))})),$(".add-submit-btn").click((function(){let type=getType();validateForm(`${type}-add`),addRecord(type),filter(),filterByInput()})),$(document).on("click","tbody tr .edit-btn",(function(){let id=$(this).parent().parent().parent().attr("class");editModal(getType(),id)})),$(document).on("change",`#${getType()}-edit-form #${getType()}-edit-department`,(function(){let departmentId=$(`#${getType()}-edit-department`).val();$(`#${getType()}-edit-location`).html(getLocationByDepartmentId(departmentId,`${getType()}-edit-location`))})),$(document).on("click",".edit-submit-btn",(function(){let type=getType(),id=$(`#${type}-edit-id`).html();validateForm(`${type}-edit`),editRecord(type,id),filter(),filterByInput()})),$(document).on("click","tbody tr .delete-btn",(function(){let id=$(this).parent().parent().parent().attr("class"),first=$(this).parent().parent().siblings().next().html(),last=$(this).parent().parent().siblings().html();deleteModal(getType(),id,first,last)})),$(document).on("click","#delete-modal-yes",(function(){let id=$("#delete-id").html();const check=!1;deleteRecord(getType(),id,!1),filter(),filterByInput()}))}));